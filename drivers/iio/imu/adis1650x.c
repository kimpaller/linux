// SPDX-License-Identifier: GPL-2.0
/*
 * adis1650x IMU driver
 *
 * Copyright 2023 Analog Devices Inc.
 */
#include <linux/iio/iio.h>
#include <linux/iio/imu/adis.h>
#include <linux/iio/imu/adis_extd.h>
#include <linux/module.h>
#include <linux/mod_devicetable.h>
#include <linux/spi/spi.h>
#include <linux/units.h>

/** @struct adis1650x_variant
 *  @brief ADIS1650x supported ids
 */
enum adis1650x_variant {
	ADIS16500,
	ADIS16505_1,
	ADIS16505_2,
	ADIS16505_3,
	ADIS16507_1,
	ADIS16507_2,
	ADIS16507_3,
};

static const struct adis_extd_data_field_map_def adis1650x_def = {
	.x_gyro			= {.reg_addr = 0x04, .reg_size = 0x04, .field_mask = 0xFFFFFFFF},
	.y_gyro			= {.reg_addr = 0x08, .reg_size = 0x04, .field_mask = 0xFFFFFFFF},
	.z_gyro			= {.reg_addr = 0x0C, .reg_size = 0x04, .field_mask = 0xFFFFFFFF},
	.x_accl			= {.reg_addr = 0x10, .reg_size = 0x04, .field_mask = 0xFFFFFFFF},
	.y_accl			= {.reg_addr = 0x14, .reg_size = 0x04, .field_mask = 0xFFFFFFFF},
	.z_accl			= {.reg_addr = 0x18, .reg_size = 0x04, .field_mask = 0xFFFFFFFF},
	.temp_out		= {.reg_addr = 0x1C, .reg_size = 0x02, .field_mask = 0x0000FFFF},
	.time_stamp		= {.reg_addr = 0x1E, .reg_size = 0x02, .field_mask = 0x0000FFFF},
	.data_cntr		= {.reg_addr = 0x22, .reg_size = 0x02, .field_mask = 0x0000FFFF},
	.x_deltang		= {.reg_addr = 0x24, .reg_size = 0x04, .field_mask = 0xFFFFFFFF},
	.y_deltang		= {.reg_addr = 0x28, .reg_size = 0x04, .field_mask = 0xFFFFFFFF},
	.z_deltang		= {.reg_addr = 0x2C, .reg_size = 0x04, .field_mask = 0xFFFFFFFF},
	.x_deltvel		= {.reg_addr = 0x30, .reg_size = 0x04, .field_mask = 0xFFFFFFFF},
	.y_deltvel		= {.reg_addr = 0x34, .reg_size = 0x04, .field_mask = 0xFFFFFFFF},
	.z_deltvel		= {.reg_addr = 0x38, .reg_size = 0x04, .field_mask = 0xFFFFFFFF},
	.xg_bias		= {.reg_addr = 0x40, .reg_size = 0x04, .field_mask = 0xFFFFFFFF},
	.yg_bias		= {.reg_addr = 0x44, .reg_size = 0x04, .field_mask = 0xFFFFFFFF},
	.zg_bias		= {.reg_addr = 0x48, .reg_size = 0x04, .field_mask = 0xFFFFFFFF},
	.xa_bias		= {.reg_addr = 0x4C, .reg_size = 0x04, .field_mask = 0xFFFFFFFF},
	.ya_bias		= {.reg_addr = 0x50, .reg_size = 0x04, .field_mask = 0xFFFFFFFF},
	.za_bias		= {.reg_addr = 0x54, .reg_size = 0x04, .field_mask = 0xFFFFFFFF},
	.filt_size_var_b	= {.reg_addr = 0x5C, .reg_size = 0x02, .field_mask = 0x00000007},
	.up_scale		= {.reg_addr = 0x62, .reg_size = 0x02, .field_mask = 0x0000FFFF},
	.dec_rate		= {.reg_addr = 0x64, .reg_size = 0x02, .field_mask = 0x000007FF},
	.gyro_meas_range	= {.reg_addr = 0x5E, .reg_size = 0x02, .field_mask = 0x0000000C},
	.firm_rev		= {.reg_addr = 0x6C, .reg_size = 0x02, .field_mask = 0x0000FFFF},
	.firm_d			= {.reg_addr = 0x6E, .reg_size = 0x02, .field_mask = 0x000000FF},
	.firm_m			= {.reg_addr = 0x6E, .reg_size = 0x02, .field_mask = 0x0000FF00},
	.firm_y			= {.reg_addr = 0x70, .reg_size = 0x02, .field_mask = 0x0000FFFF},
	.prod_id		= {.reg_addr = 0x72, .reg_size = 0x02, .field_mask = 0x0000FFFF},
	.serial_num		= {.reg_addr = 0x74, .reg_size = 0x02, .field_mask = 0x0000FFFF},
	.usr_scr_1		= {.reg_addr = 0x76, .reg_size = 0x02, .field_mask = 0x0000FFFF},
	.usr_scr_2		= {.reg_addr = 0x78, .reg_size = 0x02, .field_mask = 0x0000FFFF},
	.usr_scr_3		= {.reg_addr = 0x7A, .reg_size = 0x02, .field_mask = 0x0000FFFF},
	.fls_mem_wr_cntr	= {.reg_addr = 0x7C, .reg_size = 0x04, .field_mask = 0xFFFFFFFF},
	.msc_ctrl		= {.reg_addr = 0x60, .reg_size = 0x02, .field_mask = 0x0000FFFF},
	.dr_polarity		= {.reg_addr = 0x60, .reg_size = 0x02, .field_mask = BIT(0)},
	.sync_polarity		= {.reg_addr = 0x60, .reg_size = 0x02, .field_mask = BIT(1)},
	.sync_mode		= {.reg_addr = 0x60, .reg_size = 0x02, .field_mask = 0x0000000C},
	.sens_bw		= {.reg_addr = 0x60, .reg_size = 0x02, .field_mask = BIT(4)},
	.pt_of_perc_algnmt	= {.reg_addr = 0x60, .reg_size = 0x02, .field_mask = BIT(6)},
	.linear_accl_comp	= {.reg_addr = 0x60, .reg_size = 0x02, .field_mask = BIT(7)},
	.burst_sel		= {.reg_addr = 0x60, .reg_size = 0x02, .field_mask = BIT(8)},
	.burst32		= {.reg_addr = 0x60, .reg_size = 0x02, .field_mask = BIT(9)},
	.glob_cmd		= {.reg_addr = 0x68, .reg_size = 0x02, .field_mask = 0x0000FFFF},
	.sw_res			= {.reg_addr = 0x68, .reg_size = 0x02, .field_mask = BIT(7)},
	.fls_mem_test		= {.reg_addr = 0x68, .reg_size = 0x02, .field_mask = BIT(4)},
	.fls_mem_update		= {.reg_addr = 0x68, .reg_size = 0x02, .field_mask = BIT(3)},
	.snsr_self_test		= {.reg_addr = 0x68, .reg_size = 0x02, .field_mask = BIT(2)},
	.fact_calib_restore	= {.reg_addr = 0x68, .reg_size = 0x02, .field_mask = BIT(1)},
	.diag_stat		= {.reg_addr = 0x02, .reg_size = 0x02, .field_mask = 0x000007FE},
	.diag_data_path_overrun_mask		= BIT(1),
	.diag_fls_mem_update_failure_mask	= BIT(2),
	.diag_spi_comm_err_mask			= BIT(3),
	.diag_standby_mode_mask			= BIT(4),
	.diag_snsr_failure_mask			= BIT(5),
	.diag_mem_failure_mask			= BIT(6),
	.diag_clk_err_mask			= BIT(7),
	.diag_gyro1_failure_mask		= BIT(8),
	.diag_gyro2_failure_mask		= BIT(9),
	.diag_accl_failure_mask			= BIT(10),
};

static const struct iio_chan_spec adis1650x_channels[] = {
	ADIS_EXTD_GYRO_CHAN(adis1650x_def.x_gyro.reg_addr, X,  32, 32),
	ADIS_EXTD_GYRO_CHAN(adis1650x_def.y_gyro.reg_addr, Y,  32, 32),
	ADIS_EXTD_GYRO_CHAN(adis1650x_def.z_gyro.reg_addr, Z,  32, 32),
	ADIS_EXTD_ACCEL_CHAN(adis1650x_def.x_accl.reg_addr, X, 32, 32),
	ADIS_EXTD_ACCEL_CHAN(adis1650x_def.y_accl.reg_addr, Y, 32, 32),
	ADIS_EXTD_ACCEL_CHAN(adis1650x_def.z_accl.reg_addr, Z, 32, 32),
	ADIS_EXTD_TEMP_CHAN(adis1650x_def,                     32, 32),
	ADIS_EXTD_DELTA_ANGL_CHAN(adis1650x_def.x_deltang.reg_addr, X, 32, 32),
	ADIS_EXTD_DELTA_ANGL_CHAN(adis1650x_def.y_deltang.reg_addr, Y, 32, 32),
	ADIS_EXTD_DELTA_ANGL_CHAN(adis1650x_def.z_deltang.reg_addr, Z, 32, 32),
	ADIS_EXTD_DELTA_VEL_CHAN(adis1650x_def.x_deltvel.reg_addr, X,  32, 32),
	ADIS_EXTD_DELTA_VEL_CHAN(adis1650x_def.y_deltvel.reg_addr, Y,  32, 32),
	ADIS_EXTD_DELTA_VEL_CHAN(adis1650x_def.z_deltvel.reg_addr, Z,  32, 32),
	IIO_CHAN_SOFT_TIMESTAMP(13)
};

static const struct adis_extd_clk_freq_limit adis1650x_sync_mode[] = {
	[ADIS_EXTD_SYNC_DEFAULT] = { },
	[ADIS_EXTD_SYNC_DIRECT] = {1900, 2100},
	[ADIS_EXTD_SYNC_SCALED] = {1, 128},
	[ADIS_EXTD_SYNC_OUTPUT] = { },
};

static const struct adis_timeout adis1650x_adis_timeouts = {
	.reset_ms = 260,
	.sw_reset_ms = 260,
	.self_test_ms = 30,
};

static const struct adis_extd_timeout adis1650x_timeouts = {
	.reset_ms			= 310,
	.fact_calib_restore_ms		= 136,
	.self_test_ms			= 24,
	.fls_mem_update_ms		= 70,
	.fls_mem_test_ms		= 30,
	.sw_reset_ms			= 255,
	.filt_size_var_b_update_us	= 30,
	.dec_rate_update_us		= 30,
	.msc_reg_update_us		= 200,
	.sens_bw_update_ms		= 250,
};

static const struct adis_extd_clk_freq_limit adis1650x_sampling_clk_limits = {
	.min_freq = 1900,
	.max_freq = 2100,
};

static const struct adis_extd_chip_info adis1650x_chip_info[] = {
	[ADIS16500] = {
		.name = "adis16500",
		.num_channels = ARRAY_SIZE(adis1650x_channels),
		.channels = adis1650x_channels,
		.gyro_scale = {1, IIO_RAD_TO_DEGREE(655360)},
		.accl_scale = {1, 5349877},
		.temp_scale = {1 * MILLIDEGREE_PER_DEGREE, 10},
		.rot_scale = {2160, 31},
		.vel_scale = {400, 31},
		.int_clk = 2000,
		.sync_clk_freq_limits = adis1650x_sync_mode,
		.adis_data = ADIS_EXTD_DATA(adis1650x_def.msc_ctrl.reg_addr,
					    adis1650x_def.glob_cmd.reg_addr,
					    adis1650x_def.diag_stat.reg_addr,
					    adis1650x_def.prod_id.reg_addr,
					    adis1650x_def.snsr_self_test.reg_addr,
					    adis1650x_def.glob_cmd.reg_addr,
					    16505,
					    &adis1650x_adis_timeouts,
					    1000000,
					    16,
					    0,
					    0),
		.field_map = &adis1650x_def,
		.sync_mode_max = 3,
		.fls_mem_wr_cntr_max = 10000,
		.filt_size_var_b_max = 6,
		.dec_rate_max = 1999,
		.timeouts = &adis1650x_timeouts,
		.sampling_clk_limits	= adis1650x_sampling_clk_limits,
		.burst32_extra_bytes = 12,
	},
	[ADIS16505_1] = {
		.name = "adis16505-1",
		.num_channels = ARRAY_SIZE(adis1650x_channels),
		.channels = adis1650x_channels,
		.gyro_scale = {1, IIO_RAD_TO_DEGREE(10485760)},
		.accl_scale = {1, 26756268},
		.temp_scale = {1 * MILLIDEGREE_PER_DEGREE, 10},
		.rot_scale = {360, 31},
		.vel_scale = {100, 31},
		.int_clk = 2000,
		.sync_clk_freq_limits = adis1650x_sync_mode,
		.adis_data = ADIS_EXTD_DATA(adis1650x_def.msc_ctrl.reg_addr,
					    adis1650x_def.glob_cmd.reg_addr,
					    adis1650x_def.diag_stat.reg_addr,
					    adis1650x_def.prod_id.reg_addr,
					    adis1650x_def.snsr_self_test.reg_addr,
					    adis1650x_def.glob_cmd.reg_addr,
					    16505,
					    &adis1650x_adis_timeouts,
					    1000000,
					    16,
					    0,
					    0),
		.field_map = &adis1650x_def,
		.sync_mode_max = 3,
		.fls_mem_wr_cntr_max = 10000,
		.filt_size_var_b_max = 6,
		.dec_rate_max = 1999,
		.timeouts = &adis1650x_timeouts,
		.sampling_clk_limits	= adis1650x_sampling_clk_limits,
		.burst32_extra_bytes = 12,
	},
	[ADIS16505_2] = {
		.name = "adis16505-2",
		.num_channels = ARRAY_SIZE(adis1650x_channels),
		.channels = adis1650x_channels,
		.gyro_scale = {1, IIO_RAD_TO_DEGREE(2621440)},
		.accl_scale = {1, 26756268},
		.temp_scale = {1 * MILLIDEGREE_PER_DEGREE, 10},
		.rot_scale = {720, 31},
		.vel_scale = {100, 31},
		.int_clk = 2000,
		.sync_clk_freq_limits = adis1650x_sync_mode,
		.adis_data = ADIS_EXTD_DATA(adis1650x_def.msc_ctrl.reg_addr,
					    adis1650x_def.glob_cmd.reg_addr,
					    adis1650x_def.diag_stat.reg_addr,
					    adis1650x_def.prod_id.reg_addr,
					    adis1650x_def.snsr_self_test.reg_addr,
					    adis1650x_def.glob_cmd.reg_addr,
					    16505,
					    &adis1650x_adis_timeouts,
					    1000000,
					    16,
					    0,
					    0),
		.field_map = &adis1650x_def,
		.sync_mode_max = 3,
		.fls_mem_wr_cntr_max = 10000,
		.filt_size_var_b_max = 6,
		.dec_rate_max = 1999,
		.timeouts = &adis1650x_timeouts,
		.sampling_clk_limits	= adis1650x_sampling_clk_limits,
		.burst32_extra_bytes = 12,
	},
	[ADIS16505_3] = {
		.name = "adis16505-3",
		.num_channels = ARRAY_SIZE(adis1650x_channels),
		.channels = adis1650x_channels,
		.gyro_scale = {1, IIO_RAD_TO_DEGREE(655360)},
		.accl_scale = {1, 26756268},
		.temp_scale = {1 * MILLIDEGREE_PER_DEGREE, 10},
		.rot_scale = {2160, 31},
		.vel_scale = {100, 31},
		.int_clk = 2000,
		.sync_clk_freq_limits = adis1650x_sync_mode,
		.adis_data = ADIS_EXTD_DATA(adis1650x_def.msc_ctrl.reg_addr,
					    adis1650x_def.glob_cmd.reg_addr,
					    adis1650x_def.diag_stat.reg_addr,
					    adis1650x_def.prod_id.reg_addr,
					    adis1650x_def.snsr_self_test.reg_addr,
					    adis1650x_def.glob_cmd.reg_addr,
					    16505,
					    &adis1650x_adis_timeouts,
					    1000000,
					    16,
					    0,
					    0),
		.field_map = &adis1650x_def,
		.sync_mode_max = 3,
		.fls_mem_wr_cntr_max = 10000,
		.filt_size_var_b_max = 6,
		.dec_rate_max = 1999,
		.timeouts = &adis1650x_timeouts,
		.sampling_clk_limits	= adis1650x_sampling_clk_limits,
		.burst32_extra_bytes = 12,
	},
	[ADIS16507_1] = {
		.name = "adis16507-1",
		.num_channels = ARRAY_SIZE(adis1650x_channels),
		.channels = adis1650x_channels,
		.gyro_scale = {1, IIO_RAD_TO_DEGREE(10485760)},
		.accl_scale = {1, 5349877},
		.temp_scale = {1 * MILLIDEGREE_PER_DEGREE, 10},
		.rot_scale = {360, 31},
		.vel_scale = {400, 31},
		.int_clk = 2000,
		.sync_clk_freq_limits = adis1650x_sync_mode,
		.adis_data = ADIS_EXTD_DATA(adis1650x_def.msc_ctrl.reg_addr,
					    adis1650x_def.glob_cmd.reg_addr,
					    adis1650x_def.diag_stat.reg_addr,
					    adis1650x_def.prod_id.reg_addr,
					    adis1650x_def.snsr_self_test.reg_addr,
					    adis1650x_def.glob_cmd.reg_addr,
					    16507,
					    &adis1650x_adis_timeouts,
					    1000000,
					    16,
					    0,
					    0),
		.field_map = &adis1650x_def,
		.sync_mode_max = 3,
		.fls_mem_wr_cntr_max = 10000,
		.filt_size_var_b_max = 6,
		.dec_rate_max = 1999,
		.timeouts = &adis1650x_timeouts,
		.sampling_clk_limits	= adis1650x_sampling_clk_limits,
		.burst32_extra_bytes = 12,
	},
	[ADIS16507_2] = {
		.name = "adis16507-2",
		.num_channels = ARRAY_SIZE(adis1650x_channels),
		.channels = adis1650x_channels,
		.gyro_scale = {1, IIO_RAD_TO_DEGREE(2621440)},
		.accl_scale = {1, 5349877},
		.temp_scale = {1 * MILLIDEGREE_PER_DEGREE, 10},
		.rot_scale = {720, 31},
		.vel_scale = {400, 31},
		.int_clk = 2000,
		.sync_clk_freq_limits = adis1650x_sync_mode,
		.adis_data = ADIS_EXTD_DATA(adis1650x_def.msc_ctrl.reg_addr,
					    adis1650x_def.glob_cmd.reg_addr,
					    adis1650x_def.diag_stat.reg_addr,
					    adis1650x_def.prod_id.reg_addr,
					    adis1650x_def.snsr_self_test.reg_addr,
					    adis1650x_def.glob_cmd.reg_addr,
					    16507,
					    &adis1650x_adis_timeouts,
					    1000000,
					    16,
					    0,
					    0),
		.field_map = &adis1650x_def,
		.sync_mode_max = 3,
		.fls_mem_wr_cntr_max = 10000,
		.filt_size_var_b_max = 6,
		.dec_rate_max = 1999,
		.timeouts = &adis1650x_timeouts,
		.sampling_clk_limits	= adis1650x_sampling_clk_limits,
		.burst32_extra_bytes = 12,
	},
	[ADIS16507_3] = {
		.name = "adis16507-3",
		.num_channels = ARRAY_SIZE(adis1650x_channels),
		.channels = adis1650x_channels,
		.gyro_scale = {1, IIO_RAD_TO_DEGREE(655360)},
		.accl_scale = {1, 5349877},
		.temp_scale = {1 * MILLIDEGREE_PER_DEGREE, 10},
		.rot_scale = {2160, 31},
		.vel_scale = {400, 31},
		.int_clk = 2000,
		.sync_clk_freq_limits = adis1650x_sync_mode,
		.adis_data = ADIS_EXTD_DATA(adis1650x_def.msc_ctrl.reg_addr,
					    adis1650x_def.glob_cmd.reg_addr,
					    adis1650x_def.diag_stat.reg_addr,
					    adis1650x_def.prod_id.reg_addr,
					    adis1650x_def.snsr_self_test.reg_addr,
					    adis1650x_def.glob_cmd.reg_addr,
					    16507,
					    &adis1650x_adis_timeouts,
					    1000000,
					    16,
					    0,
					    0),
		.field_map = &adis1650x_def,
		.sync_mode_max = 3,
		.fls_mem_wr_cntr_max = 10000,
		.filt_size_var_b_max = 6,
		.dec_rate_max = 1999,
		.timeouts = &adis1650x_timeouts,
		.sampling_clk_limits	= adis1650x_sampling_clk_limits,
		.burst32_extra_bytes = 12,
	},
};

static const enum adis_extd_debug_attr adis1650x_debug_attr[] = {
	ADIS_EXTD_DIAG_DATA_PATH_OVERRUN,
	ADIS_EXTD_DIAG_FLS_MEM_UPDATE_FAILURE,
	ADIS_EXTD_DIAG_SPI_COMM_ERR,
	ADIS_EXTD_DIAG_STANDBY_MODE,
	ADIS_EXTD_DIAG_SNSR_FAILURE,
	ADIS_EXTD_DIAG_MEM_FAILURE,
	ADIS_EXTD_DIAG_CLK_ERR,
	ADIS_EXTD_DIAG_GYRO1_FAILURE,
	ADIS_EXTD_DIAG_GYRO2_FAILURE,
	ADIS_EXTD_DIAG_ACCL_FAILURE,
	ADIS_EXTD_DIAG_CHECKSUM_ERR,
	ADIS_EXTD_DIAG_FLS_MEM_WR_CNT_EXCEED,
	ADIS_EXTD_DIAG_LOST_SAMPLES_COUNT,
	ADIS_EXTD_TIME_STAMP,
	ADIS_EXTD_DATA_CNTR,
	ADIS_EXTD_FILT_SIZE_VAR_B,
	ADIS_EXTD_GYRO_MEAS_RANGE,
	ADIS_EXTD_DR_POLARITY,
	ADIS_EXTD_SYNC_POLARITY,
	ADIS_EXTD_SYNC_MODE,
	ADIS_EXTD_SENS_BW,
	ADIS_EXTD_PT_OF_PERC_ALGNMT,
	ADIS_EXTD_LINEAR_ACCL_COMP,
	ADIS_EXTD_BURST_SEL,
	ADIS_EXTD_BURST32,
	ADIS_EXTD_UP_SCALE,
	ADIS_EXTD_DEC_RATE,
	ADIS_EXTD_CMD_FACT_CALIB_RESTORE,
	ADIS_EXTD_CMD_SNSR_SELF_TEST,
	ADIS_EXTD_CMD_FLS_MEM_UPDATE,
	ADIS_EXTD_CMD_FLS_MEM_TEST,
	ADIS_EXTD_CMD_SW_RES,
	ADIS_EXTD_FIRM_REV,
	ADIS_EXTD_FIRM_DATE,
	ADIS_EXTD_PROD_ID,
	ADIS_EXTD_SERIAL_NUM,
	ADIS_EXTD_USR_SCR_1,
	ADIS_EXTD_USR_SCR_2,
	ADIS_EXTD_USR_SCR_3,
	ADIS_EXTD_FLS_MEM_WR_CNTR,
};

static const struct of_device_id adis1650x_of_match[] = {
	{
		.compatible = "adi,adis16500_extd",
		.data = &adis1650x_chip_info[ADIS16500]
	},
	{
		.compatible = "adi,adis16505-1_extd",
		.data = &adis1650x_chip_info[ADIS16505_1]
	},
	{
		.compatible = "adi,adis16505-2_extd",
		.data = &adis1650x_chip_info[ADIS16505_2]
	},
	{
		.compatible = "adi,adis16505-3_extd",
		.data = &adis1650x_chip_info[ADIS16505_3]
	},
	{
		.compatible = "adi,adis16507-1_extd",
		.data = &adis1650x_chip_info[ADIS16507_1]
	},
	{
		.compatible = "adi,adis16507-2_extd",
		.data = &adis1650x_chip_info[ADIS16507_2]
	},
	{
		.compatible = "adi,adis16507-3_extd",
		.data = &adis1650x_chip_info[ADIS16507_3]
	},
	{ },
};
MODULE_DEVICE_TABLE(of, adis1650x_of_match);

static const struct spi_device_id adis1650x_spi_id[] = {
	{ "adis16500_extd", (kernel_ulong_t)&adis1650x_of_match[ADIS16500] },
	{ "adis16505-1_extd", (kernel_ulong_t)&adis1650x_of_match[ADIS16505_1] },
	{ "adis16505-2_extd", (kernel_ulong_t)&adis1650x_of_match[ADIS16505_2] },
	{ "adis16505-3_extd", (kernel_ulong_t)&adis1650x_of_match[ADIS16505_3] },
	{ "adis16507-1_extd", (kernel_ulong_t)&adis1650x_of_match[ADIS16507_1] },
	{ "adis16507-2_extd", (kernel_ulong_t)&adis1650x_of_match[ADIS16507_2] },
	{ "adis16507-3_extd", (kernel_ulong_t)&adis1650x_of_match[ADIS16507_3] },
	{ }
};
MODULE_DEVICE_TABLE(spi, adis1650x_spi_id);

static int adis1650x_probe(struct spi_device *spi)
{
	return adis_extd_init(spi, adis1650x_debug_attr,
			      ARRAY_SIZE(adis1650x_debug_attr));
}

static struct spi_driver adis1650x_driver = {
	.driver = {
		.name = "adis1650x",
		.of_match_table = adis1650x_of_match,
	},
	.probe = adis1650x_probe,
	.id_table = adis1650x_spi_id,
};
module_spi_driver(adis1650x_driver);

MODULE_AUTHOR("Ramona Bolboaca <ramona.bolboaca@analog.com>");
MODULE_DESCRIPTION("Analog Devices adis1650x IMU driver");
MODULE_LICENSE("GPL");
MODULE_IMPORT_NS(IIO_ADISLIB);
MODULE_IMPORT_NS(IIO_ADIS_EXTDLIB);
